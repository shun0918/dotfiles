"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.NpmTestApi = void 0;
const axios_1 = __importDefault(require("axios"));
const headers_1 = require("../../common/api/headers");
const instance_1 = require("../../common/configuration/instance");
const proxy_1 = require("../../common/proxy");
class NpmTestApi {
    constructor(logger, workspace) {
        this.logger = logger;
        this.workspace = workspace;
        this.instance = null;
    }
    get http() {
        return this.instance != null ? this.instance : this.initHttp();
    }
    async initHttp() {
        const http = axios_1.default.create({
            headers: headers_1.DEFAULT_API_HEADERS,
            responseType: 'json',
            baseURL: instance_1.configuration.authHost + '/test',
            ...(await (0, proxy_1.getAxiosConfig)(this.workspace, instance_1.configuration, this.logger)),
        });
        http.interceptors.response.use(response => response, error => {
            this.logger.error(`Call to Snyk NPM Test API failed. ${error}`);
            return Promise.reject(error);
        });
        this.instance = Promise.resolve(http);
        return http;
    }
    async get(url, config) {
        return (await this.http).get(url, config);
    }
}
exports.NpmTestApi = NpmTestApi;
//# sourceMappingURL=npmTestApi.js.map