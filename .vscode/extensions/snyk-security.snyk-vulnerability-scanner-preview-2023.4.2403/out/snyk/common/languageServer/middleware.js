"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.LanguageClientMiddleware = void 0;
const settings_1 = require("./settings");
class LanguageClientMiddleware {
    constructor(configuration, experimentService) {
        this.configuration = configuration;
        this.experimentService = experimentService;
        this.workspace = {
            configuration: async (params, token, next) => {
                let settings = next(params, token);
                if (this.isThenable(settings)) {
                    settings = await settings;
                }
                if (settings instanceof Error) {
                    return settings;
                }
                if (!settings.length) {
                    return [];
                }
                const serverSettings = await settings_1.LanguageServerSettings.fromConfiguration(this.configuration, this.experimentService);
                return [serverSettings];
            },
        };
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    isThenable(v) {
        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access
        return typeof (v === null || v === void 0 ? void 0 : v.then) === 'function';
    }
}
exports.LanguageClientMiddleware = LanguageClientMiddleware;
//# sourceMappingURL=middleware.js.map