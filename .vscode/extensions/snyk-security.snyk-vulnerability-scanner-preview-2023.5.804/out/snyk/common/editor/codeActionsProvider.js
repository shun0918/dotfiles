"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CodeActionsProvider = void 0;
const general_1 = require("../../common/constants/general");
class CodeActionsProvider {
    constructor(issues, codeActionKindAdapter, analytics) {
        this.issues = issues;
        this.codeActionKindAdapter = codeActionKindAdapter;
        this.analytics = analytics;
        this.providedCodeActionKinds = [this.codeActionKindAdapter.getQuickFix()];
    }
    getProvidedCodeActionKinds() {
        return this.providedCodeActionKinds;
    }
    provideCodeActions(document, clickedRange) {
        if (this.issues.size === 0) {
            return undefined;
        }
        for (const result of this.issues.entries()) {
            const folderPath = result[0];
            const issues = result[1];
            if (issues instanceof Error || !issues) {
                continue;
            }
            const { issue, range } = this.findIssueWithRange(issues, document, clickedRange);
            if (!issue || !range) {
                continue;
            }
            const codeActions = this.getActions(folderPath, document, issue, range);
            const analyticsType = this.getAnalyticsActionTypes();
            this.analytics.logQuickFixIsDisplayed({
                quickFixType: analyticsType,
                ide: general_1.IDE_NAME,
            });
            // returns list of actions, all new actions should be added to this list
            return codeActions;
        }
        return undefined;
    }
    findIssueWithRange(result, document, clickedRange) {
        let range = undefined;
        const issue = result.find(issue => {
            if (issue.filePath !== document.uri.fsPath) {
                return false;
            }
            range = this.getIssueRange(issue);
            return range.contains(clickedRange);
        });
        return { issue, range };
    }
}
exports.CodeActionsProvider = CodeActionsProvider;
//# sourceMappingURL=codeActionsProvider.js.map