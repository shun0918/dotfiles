"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class AdvisorProvider {
    constructor(advisorApiClient, logger) {
        this.advisorApiClient = advisorApiClient;
        this.logger = logger;
        this.cachePackages = [];
    }
    async getScores(modules) {
        const scores = [];
        try {
            const packages = modules.map(({ name }) => name);
            if (!packages.filter(pkg => !this.cachePackages.includes(pkg)).length) {
                return this.scores;
            }
            if (!packages.length) {
                return scores;
            }
            const res = await this.advisorApiClient.post(this.advisorApiClient.apiPath, modules.map(({ name }) => name));
            if (res.data) {
                this.scores = res.data;
                this.cachePackages = this.scores.map(advisorScore => {
                    if (!advisorScore) {
                        return '';
                    }
                    if (!advisorScore.name) {
                        return '';
                    }
                    return advisorScore.name;
                });
                return res.data;
            }
        }
        catch (err) {
            if (err instanceof Error) {
                this.logger.error(`Failed to get scores: ${err.message}`);
            }
        }
        return scores;
    }
}
exports.default = AdvisorProvider;
//# sourceMappingURL=advisorProvider.js.map